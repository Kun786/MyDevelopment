First Command updat teh whole server
sudo apt-get update && sudo apt-get upgrade -y






Second Command to install Apache2 server
apt install apache2 (it is used for reverse proxy)



third Step Go to cloud flare
samhudson009@gmail.com
Re^m@n1!!

Signup with cloudFlasre
It will prompt you for the domain name > Add domain name > it will automatically get the domain info > it will give you some
instructions to follow > the instructions will be to add cloudflasre server to your dmoain name server(go dady) and then update it
now your webapplication will be running from your cloudflare.

Note use free account type for cloud flare.:

Step 4
Install dependencies ufw (Its a firewall to make the application more secure)
root@SkillstitutePakistan:~# ufw default deny incoming
Default incoming policy changed to 'deny'
(be sure to update your rules accordingly)
root@SkillstitutePakistan:~# ufw default allow outgoing
Default outgoing policy changed to 'allow'
(be sure to update your rules accordingly)
root@SkillstitutePakistan:~# ufw allow 22
Rules updated
Rules updated (v6)
root@SkillstitutePakistan:~# ufw allow 443
Rules updated
Rules updated (v6)
root@SkillstitutePakistan:~# ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
ufw is already the newest version (0.36-6).
ufw set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
root@SkillstitutePakistan:~# ufw default allow
Default incoming policy changed to 'allow'
(be sure to update your rules accordingly)
root@SkillstitutePakistan:~# ufw default allow incoming
Default incoming policy changed to 'allow'
(be sure to update your rules accordingly)
root@SkillstitutePakistan:~# ufw default disallow incoming


These are the commands help you to access the ports where you application entry point through https or ssh





Now How to Hardening the server:


cat /etc/passwd 


Some Usefull Commands
### Disable Password Prompt for Users When Using Pub/Private Key Auth:
visudo -f /etc/sudoers.d/90-cloud-init-users
# User rules for ubuntu
ubuntu ALL=(ALL) NOPASSWD:ALL

### sshd_config Setting:
PermitEmptyPasswords no
PermitRootLogin no
AllowUsers testUser
Protocol 2
PasswordAuthentication no

## Test the config
sshd -t















******************* Summary *****************




Open SSH

What is open ssh. Its a software/ remote management tool that gives you to access to run commands on another machine. And Developed by OpenBSD project.

Open ssh use port 22. port is the entry point of the application.

in .ssh known_ssh file has the fingerprints interm of keys it will actually check are you the same guy who is accessing the server and it only ask you the first time after that it wont ask you again. known_host file is always on your local machine and it has the information for your servers that you have connected.

An Example for it is that if someone created a malicious server with same ip address so when you try to connect it will have different finger print and there you can check if i already connected to this server why it asking my again so there is something fishy.


How Connection created between local<---->Remote. Local(privatekey)===Remote(PublicKey) //Its is done by a mathematical algorithm


Note the sequence is not in order the correct order is 


	1 Setup Server (DO, AWS, Azure, GCP)
	2 Creat Config file on local machine and add details/credentials
	3 Add ssh key.pub
	4 Connect server Via ssh key.pub
	5 Update and Upgrade your linux ubuntu server
	6 Install node globally
	7 Install pm2 globally
	8 Install apache2 globally
	9 hardening the Server
	10 Configure the apache2 server and secure it
	
	
	 


********************Part1****************************

<><><><><><><><><><Enviormental Variable and securing your application><><><><><><><><><>


	Why we need to setup enviorment variables. Because we dont want to share application's important variables so 
	we want to hide them and load them in the memory when needed.
	So how can we achieve it
	
	In Nodejs there is a node module called dotenv which helps to load our vaiables in the memory.
	
	In console: you can set enviorment variable as then run in memeory
		in app.js {
			
			console.log(process.env.PORT);
			
		}
		
		in terminal set PORT = 5000
		and then node app.js
		result: 5000
		
	Lets break it down. The process.env "process is the object and env
	has the key of variables" this is actually express/nodejs object but
	load your variables into memory you need dotenv nodemodule which 
	loads you .env file variables into your memeory.
	
	
	Lets BreakDown Step By Step
	 	1 make EnviromentalVariable.env{
	 		PORT=8081 //Conventions we use Block Letters for Variable
	 	}
	
		2 Install npm i dotenv
		
		3 How To use dotenv to load the enviormental variables in memeory (localSys)

		4 First require the dotenv int EnviromentVariables.js
			{
			
			const dotenv = require('dotenv');
			
			Then to set you .env variables you need to use the 
			function called dotenv.config ({
				## Here you need to give path to your file
				
				path:`${_dirname}/../EnviromentalVariable.env.
				})			
			}
			
		5 To check either our variables set or not we use two methods
			console.log(process.env);//Will print all env variables
			or
			console.log(dotenv.parsed);//Will print your application variables

	
	
	

*************Part 2*********************

<><><><><><><><><><Hardening The Server><><><><><><><><><>

How to access the server 
	1 You can access the server by using ssh @ipaddress or you can have a config file from there ssh can help you to connect server.
	2 You can access the server by using ssh key
	3 You can see who has accessed your serve by going to cd /var/log# and here you can have a auth.log file to check that.
	
	
	
	
How to setup the ssh key on to the server
	1 Lets Creat the ssh keys
	2 command ssh-keygen
	3 It will promot where to save with file name (we can change the file name)
	4 Prompt Enter the passpharase (must add its very important)
	5 How to copy the ssh key to the remote server Follow the following instructions
		1a The hard way by copy the public key from your local machine and paste it into remote server in .ssh with authorized_keys
		2a you can use command and the command is 
			ssh-copy-id -i ~/.ssh/the name of the file root@ip
			~/.ssh/name of key ## its our local directory
			Workking: this whole command ssh-copy-id -i ~/.ssh/the name of the file whill create .ssh folder and create authorized_keys on my remote server and popoluate that key into it
			ssh -o IdentitiesOnly=yes -i trust4pay.pub root@64.227.182.75 // when you are not logged in
	6 Optional ssh-keygen -t ed25519 "Any Comment Which Will add in the end of key"(more secure and shorter than rsa)
		prompt (/home/fazi/.ssh/id_ed25519) but lets change the name using this command (/home/fazi/.ssh/NewKey_id_ed25519
		prompt (enter the passpharase) and then add passpharase and then here you go they key
		
			
How to configure the server in the file and run directly from there.
	Config files add the entry point details/credentials for you server
	
	1 Why we need it? Because its hard to remeber the server ip address so you can have a config file to overcome it
	2 go to ~/.ssh and creat a file touch or nano or cat config
	3 Follow the instructions
		Host faziServer
		  Hostname ipaddress
		  Port 22 (we can change it)
		  User root (we can chage it)
		  IdentityFile ~/.ssh/PromiseFitness_id_ed25519 (optional when ssh cant find the file)

How to Hardening the server
	1 After accessing the server
	2 sudo apt update
	3 sudo apt upgrade
	4 Add a new user and stop root login: useradd -m -s /bin/bash fazi2
	5 Add password for newly created user by using this command sudo passwd fazi2
	6 for verfication run command groups fazi2
	7 now switch user to newly created user by using this command su - fazi2
	8 To check again that your newly created user have sudo permissions just run any sudo command "sudo apt update"  
	if its not suo run adduser fazi sudo (You have to make new user sudo)
	
	9 Last thing you need to configure sshd file to allow which user to enter. nano/etc/ssh/sshd_config
		You  need to change two keys here  PermitRootLogin yes (no) -> PasswordAuthentication no
		"AllowUsers fazi2 fazi jay rob"
	10 Thats it (In end do this sudo systemctl restart sshd)
	11 Note When you are settingup the server it has default user root which have our ssh key in ~/.ssh/id_key.pub but when you ahve created the new user it dont have that key so you have to follow it
		1 go to cd /home/newuser
		2 mkdir .ssh
		3 nano /.ssh/authorized_keys
		4 copy the key from ~/.ssh/id_key from root and paste to you authorized_keys file  (scp dummy_keys trust4pay:~/.ssh/xyz_keys) Syntax
		5 Here you go the server is harden now
	
To Remove user and its folder.
	1 sudo userdel username
	2 sudo rm -r /home/username
	
	
	
	
	

*************Part 3*********************

<><><><><><><><><><Apache2 Server><><><><><><><><><>


Why installing apache webserver ? For installing Apache WebServer is to have proxy setup for your webapplication.

What is proxy server: It is the intermediate server which actully operates the protocols of the client/users to web browser.

Step1 ***************** 

you need to install npm apache2 
then you will find it in /etc folder as we remember etc contain all the configuration files.

now in cd /etc/apache 2/
here you can find sites-avaialbel folder and in that there is 000-default.conf file where you can setup your proxy server configuration

you can create you on .conf file

Example of your server configuration:
<VirtualHost *:80>

	ServerName fazi.net (if you have your domain)
	ServerAlias www.fazi.net
	
	ProxyPreserveHost on
	ProxyPass / http://localhost:7070/ (This Url will be replaced by your domain name)
</VirtualHost>


Once You Setp you need to reload the apache2 server using this command 
sudo /etc/init.d/apache2 reload

Step2 *****************

Now if your website is on maintainence then how to setup the proxy server.


Step3 *****************

How to configure custome .conf file and how to add domains in hosts file in /etc/hosts 



How To run multiple applications from one server/droplet using apache2 server
	
	How to configure apache2 server
	
	How to show Website is under construction using apache2 server
	
	How to restric ip who can access website
	
	How to Use cloudflare to use https
	
	


	


********************Part4****************************

<><><><><><><><><><Add Your Application to the Server Using Git Repo><><><><><><><><><>	

	
	How To add your application to the Server Using Git Repo
		
		1.a Insatll node js to your server globally
		1 Once your Enviormental variable are setup
		2 And You have HArdening your server and created your own user
		3 Add your rep by using "git clone" in that user 
		4 cd to your application and run npn i
		5 Install npm pm2 -g
		6 then run your application by using pm2 entrypoint.js
		7 pm2 logs to check any errors
		8 If application is updated run git pull then again pm2 entrypoint.js
		
		
		
		
		
		
		
		
********************Part5****************************

<><><><><><><><><><Deploy Your Application On Heroku><><><><><><><><><>

	1 What is Heroku:  Container-Based Cloud Platform as a Service:
	2

		
